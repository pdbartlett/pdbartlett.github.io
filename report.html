<html>
 <head>
  <title>TORN Ranked War processing</title>
  <script lang="text/javascript">
   function fetchAll() {
    const fid = document.getElementById('fid').value;
    fetch('https://api.torn.com/v2/faction/' + fid + '/rankedwars', {
     headers: {
      'Authorization': 'ApiKey ' + document.getElementById('key').value,
     }
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(data => {
      console.log(data);
      var html = "";
      for (const war of data.rankedwars) {
        html += "<a href='javascript:fetchOne(" + war.id + ")'>" + war.id + "</a>:" +
                war.factions[0].name + " vs. " + war.factions[1].name +
                " [" + (war.winner == fid ? "W" : "L") + "]<br/>";
      }
      document.getElementById('data-container').innerHTML = html;
    })
    .catch(error => console.error('Error fetching or parsing JSON:', error));
   }
   function fetchOne(rwid) {
    const fid = document.getElementById('fid').value;
    var fromTS, toTS;
    fetch('https://api.torn.com/v2/faction/' + rwid + '/rankedwarreport', {
     headers: {
      'Authorization': 'ApiKey ' + document.getElementById('key').value,
     }
    })
    .then(response => {
     if (!response.ok) {
      throw new Error('Network response was not ok');
     }
     return response.json();
    })
    .then(data => {
     console.log(data);
     fromTS = data.rankedwarreport.start;
     toTS = data.rankedwarreport.end;
     for (const faction of data.rankedwarreport.factions) {
      if (faction.id != fid) continue;
      var html = "<table><thead><tr><td><b>Name</b></td><td><b>Attacks</b></td></tr></thead><tbody>";
      for (const m of faction.members) {
       html += "<tr><td>" + m.name + "</td><td>" + m.attacks + "</td></tr>";
      }
      html += "</tbody></table>";
      document.getElementById('data-container').innerHTML = html;
     }
    })
    .catch(error => console.error('Error fetching or parsing JSON:', error));
   }
  </script>
 </head>
 <body>
  <h1>TORN Ranked War processing</h1>
  <label for="key">API key:</label> <input id="key" type="text" />
  <label for="fid">Faction ID:</label> <input id="fid" type="text" />
  <button type="button" onclick="fetchAll()">Fetch</button>
  <p id='data-container'></p>
</html>
